## Разворачивание тестовой среды 

1. Запустите компоуз файл для поднятия MongoDB
```
docker-compose up --build 
```

2. Выполните команду pip -r install requirements.txt
3. Запускайте **mongodb.py**
4. Результаты замера будут в папке **results/**

## Сгенерированные данные

Первичные данные

| Тип данных     | Количество |
|----------------|------------|
| Пользователи   | 200 000    |
| Фильмы         | 5 000      |
| Текст рецензии | 15         |

Методы для повторной генерации этих данных находятся в **work_with_data.py**. Обновятся данные в папке **./data**.

Эмуляция пользовательской активности:

| Тип данных | Количество |
|------------|------------|
| Лайки      | 10 000 000 |
| Рецензии   | 5 000 000  |
| Закладки   | 1 903 862  |

Методы для повторной генерации этих данных находятся в **mongodb.py**. Обновятся записи в базе MongoDB.

## Время получения агрегированной информации

Все тесты выполнялись в двух случаях:
- Только чтение данных (отсутствие других процессов)
- Чтение при продолжающейся записи данных малыми порциями

### Получение рейтинга фильма

Рейтинг фильма рассчитывается на основании лайков и дизлайков. Среднее число записей для одного фильма 2 000.

Для теста выбирались 100 случайных фильмов.

| Метрика          | Чистое время (ms) | Время с записью (ms) | 
|------------------|-------------------|----------------------|
| Минимум          | 160               | 192                  |
| Максимум         | 1000              | 1220                 |
| Среднее          | 330               | 352                  |
| Станд.отклонение | 180               | 222                  |


### Получение всех лайков пользователя

Среднее число лайков и дизлайков одного пользователя 50. Среднее число лайков 25.

Для теста выбирались 100 случайных пользователей.

| Метрика          | Чистое время (ms) | Время с записью (ms) | 
|------------------|-------------------|----------------------|
| Минимум          | 4.5               | 6.1                  |
| Максимум         | 17.7              | 25.8                 |
| Среднее          | 7.5               | 8.6                  |
| Станд.отклонение | 1.8               | 2.4                  |


### Получение закладок пользователя

Среднее число закладок одного пользователя равно 10.

Для теста выбирались 100 случайных пользователей.

| Метрика          | Чистое время (ms) | Время с записью (ms) | 
|------------------|-------------------|----------------------|
| Минимум          | 1.5               | 1.6                  |
| Максимум         | 11.3              | 6.7                  |
| Среднее          | 2.6               | 2.5                  |
| Станд.отклонение | 1.2               | 0.7                  |


## Выводы

Получение данных по пользователю выполняется за приемлемое время.
Получение рейтинга фильмов немного превосходит выбранные 200 ms. Скорее всего это связано с большим количеством записей по каждому фильму. Необходимо точнее оценить ожидаемое число лайков для 10% самых просматриваемых фильмов. Если выбранная отметка 2000 лайков и дизлаков реалистична, то нужно выполнять расчет рейтинга по расписанию и хранить новую таблицу с рейтингами.